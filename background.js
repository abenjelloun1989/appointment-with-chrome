// background.js
const departmentCodes = ["075", "077", "078", "091", "092", "093", "094", "095"];
chrome.browserAction.onClicked.addListener(checkAppointment);

function checkAppointment() {
  departmentCodes.forEach((code) => {
    console.log(`Checking for appointment in department code ${code}...`);
    fetch(`https://candidat.permisdeconduire.gouv.fr/api/v1/candidat/creneaux?code-departement=${code}`, {
      method: 'GET',
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json',
        'Cookie': `TCPID=1221261643241052067167; __troRUID=ef288d9b-0421-4fb1-a5db-43418809f5c8; __troSYNC=1; __trossion=1670082217_1800_7_ef288d9b-0421-4fb1-a5db-43418809f5c8%3A1674764651_ef288d9b-0421-4fb1-a5db-43418809f5c8%3A1674769729_1674769734_2_; mod_auth_openidc_session_0=eyJhbGciOiAiZGlyIiwgImVuYyI6ICJBMjU2R0NNIn0..tgbPwgPbHfqNTITZ.awmM0cdXEEcuHDCSiNPlVCc8ZA7kwgyWuomuhG0exnHASaiMZpOi6AlsV3yIqGDV1BaaP7aFXPoXOoBkT429yUZ-BvvVGZoz-Z1uHmVGBA6TKvcHQijEH1GPzHis_8GBHz3b9P5tle8Ld4lG8uLrvEVqox3OEGIO5t5SxgW-THmS4pf7isSqgTQM9zJ_ZtZBbkAG95xI0rHiGDoLdIp5ebALg9bQikU_s6SScet9VmBgrLHeDEHT0pvwXHXubQ-kldPFXVjGd3omFNebJrz8ff1xcLoFTgTGaOrgbazTWa5RiowLDsqHfODmR24wRsSi3KVIkqsq9GPLCxypIzWb1usTArPMFiO31p1CbpHTaS-ieAkP3Ljld2weh7yVvVCbN4-foPqA9e1uY6vHmGB5-MbAlfi0LxxtJPU0H12XqFfIXjNjM85dAPHdEN82d0RAW4qG_jWJmXYc0uXey3GEs0dXqmHAvLYSW6A-7KGaPO2_m3eH1Rcm8zVy5sSQrl3upzGXP964N-P1FznONMxsbNjZo1UNmI9hh9rdNG6JUCq3-B6hf9BZgY9vgZog_kGadLMY74ultVGJXHsOM5pBMlHjOYaEZN6kDWtn13c68ZqJoYRu7UrT_QGM9qKm3Iv7ZkArIYmqlE8mXljiF00QAnaWGiWgPGYXVtJ8uor4bRaahN-Kzf_KeW4wktXmUkZ9yTAkdSGNnelHH2I-lggcALoN6Y1yH4glpA0Dr6Lh1VnDWNT-OU8Tvwbc2CIcU3AO6Rqxg4_HkCOHO-Jj_Mc_dQZ5ZzQBnVeP0eYPZEovjjI27nQpFpm4k4N5SX8Z22c_V_rNe1LqhDzrO11YB3NfNJCLVvZIwgGr2KR5-q-cQAbkEkqnKcmMM_5kDLch0kEY7ihBFT_cII9gqY4JatVozYefm8r76xDI_hlJGICWpU2AKXkMEg6uRzu_LFC9T-t1l2mB50IHIJ42C_PcTZaMzjZleR7iGs3mkfa0kuPBF5G1gZaHUopsLEBD61vfLz-fDKURqjHcz__tQHL4PY4T0fmCCtlbWScZPtlLKvzju4Tn8LHxS6u72HhZih72GWocLUNKEJ874cBMxkzL-goKs4QjvAaGDqPSXltNvOFGJIDt7SOyxQeUsjo7NXVqR8boqPh7AT8PjLXAgL2eAPqQzchd1dr-Zoup1YkbooK7_Fnxy43ib4pbJ1qZ6Fi4qfv-i_iDv1comI4_Glux6bLTf9wFrgQlJ9BJLf-1gD7RAmB4jbOu8a6zNeXM_WBLP7dRzLtFiLCzVhx3XPcPjph1wUYhs2aKYpcDPyKqi62nmv7YP_0ZGpYOljzVDmv7EosDQmFiiqvMW3COdmJc7eDx3eEoXqDDfLtfSE3rMUD9f6xmmStLfRHO57fKU7uGi9h7_xUBWiG_R0zduustnMu68_viLTrfa_W3y49PzGXIunqSSEVdiOHa9NcVKoMVWek0JmG4ZNMOraGH_0_QsB7uAmjUsq4E9TpGeqpqMvbUAj4AsqBbxc1Vn5k60BDiRMrXLGX_Ei-be67H7ZhhfyZtI_fu2odkOrn_d4DoRXJPOWzVeTFXTYmQwUB-sZ4ONwGwUoin8rUKxFhWcydTfllbWNn9pHWQLOj1pCgQhD7FzTJvImYFKlSbJHHYnp55rK6WYAKGC8cuai1hC5-DbkPODsgjFT8wfnS_c-7sZVSTosl4f5GVAOXduRQyzT3YO3ZPk8qlYF_lc7Kojg7__8vY8D7eEF74CrXhyEsa_bz5MrMqN6C4rfzUDbMIGaDHD3Km6-7uvUg_140Q0LzjJa8V-eRHT2zkGaqRm6PsqOrwSLy6DbxFRzzPlrUKBaiYutTEBrA3PEOCt9hhkSyGvCC1DwtOjDnvcVZwW63Qeo4yb4-PK4oOHsmdmdFwxjN4mLlwFZSqIjZmzYyY0-3ZNXkclOhVbNb7yMlZbi90mNqm2cZGkbXxNy770NLEYCFByv0hByJoJ1WCN1QM2CRMM3Rm0MhgDYw0kUs_REJOgEQLFsw7jBpRzx1VijRXIbXulxu2wx3D4ISJpKyUsrp8I4rIcCL67Gyb1OlXPac0t18SPV1elhwf42vyDkdr4MB6T6vSNlFf7EvS09opUxeT_3DVd6QWHMOVNjcqTwo0f_sv-IK6DxI5ObxBygFQ6d05SuSsVn_VPHKdapYpuXjwDQix88vOMyj5EIUS6CmZKumRn3NDI9-mroQZLmFVUYzaJncY43pGFOMyZ-z4pojKw4lZYiP6WeqTuummlOxFJ32bsKs7qjl47qS8iiZwBmqkkcouxL3xC8owK7I3azIvPMkP9b15f29lyiQkxOlQP_fRB77SDhsNd1Vi_Wz423n_sRyA-0BFOaQ-MzAIEQtSMEZQApO6ShLalYYRh2IFSpTnnLAcR3HOhk5KDv23iuA3kW6CIg5f_x2agRkXSWiDER2A8VuL995m3iy0-OHTCFNZIIUKDjagYbrZC6eGWCzTIwGJks0M9GdKzNMXo4oTBF0BEMlymugwBzKP3EUuEbRTqU97gbNxziiFHaq4bG7jLF6J8s0TRf5CC2HN1ZRiAt9TldyodWUW6qmLeiHRul0bFw8iqLVOs3e-C8lKnBOkQLvAM007jPFrAfgLzIKchpb6eFDQF9Q8S2lt5Z3VnYK6cD9R42oWOs-WOH1-Ep702M3N8eg3Hn7V_fsBiiZSAH7W2D4m8n_6Gli6-4y9HLnxn_CT9X5bBYrOMsqMVgRBlktJQrIPsMePOnYv-5LgWR3eZlVnUeEG19_21GvnFY5la0uTqCVRh6anEc7V_pEgQkofhtp_-KDKlDDlv3Qugw3l5UrRw21iFpzGvnVF6FJORLML8stYY4n25ML7tw9cJMR_9lOMaIh2zjcSc2s5PaCnjBv-ocUqSyI7Kbqn3smcPPaoxqUJ_eP-Xvl6KO3HlVNATGXrdmSjVOMeTKtbEibmvo0hJhkl_7rRNq06eWrvmbxUC7TJ14knBiaVinF6nTPltKpvosV38MLQQgk_HJP9zLHHsuoUCrO1KAO1NLJGfrhv7QS4F4hxr58VAyg5JOmHnMtu3T92NENCsj1MWPQG9gVkoEXOBMRZwGKSg5y8gYYwtRvbV76s1juRNIcQYqNVpn_NLc3nOgciihNNldpxMNYr-wMkxZiGN78_dueTMKGN2S5rILTYe0FSMEre7Lr_Uzh9IBDKl2yN7FD8KRv0sIXDFoHwHZYQlIoCsARDLrc_KypxQacR1PDbhkDcGOB9Wn5EtTFmmS_yl30FRfhplPK9-576X0lKY5ThqAihZo5nYD18jNOpiV3EACM69ZogOFfYi_Fx4GkAXsb0-GneflPu5b5sECjxxKZEz5hsxJDI_6p81nICIq0_YU5fGMDEUL7U46grKigBBsUvr4fAseYdgeBnrpA-UXteC3wWdpq9zmQPQ-UdMknqu2LtTtOOmBpd4ezmUhhnWsQuIIrg7GtHWJqW9eaWyKnGZ_oTUCkIUbyfQ-2z7rYdj2H7Wb3pqyja0S1WoDIa9hD3Q6D03DRcktIR_5DCmbcyiJ_7MeaIBlzPEYUDzDP83wiWSBCCTTMEMrbEN1nqaCB_g3qzSDRRUZcAYptSD5rZGAyHuKLkCGJMxI1b8CnzLHUoVyUCxwa43spT8W8dXLwiYuIEFZzcJmoPkBG_iOWKAVzzSwvVq9wlwZlvMyHhwfQ5D_O0WXvoloSgCtHMlAN197jA0NxDExmMdlSmFTMVYuBJ-uPbWpc1AdZbxKsQVi_bLfZobBNH3sHPJ3uooT6bl17HzmvuKNwf11gSOFXFzxKJ25nXWj4gURsx4cDAcnk4jA_uJwQoh6M7Hk5y5ZlAT7iAgcjhd6x-cPKaDh2Jj6F_qc9nHpzB; mod_auth_openidc_session_1=ZmynKRdwjJmrX1yEC4O9uEQo4sgUfdoI5QOB0QANj6V6BsjRxZtrwip6IdlDutcGDhbP8SppQbd9JEyLkFdV_mrqFLknv4UoCEtm6GYbzGgclxIa_m8lJRkHdk2WrAsByNxmBwBhlqIxiEdKnjT06ySoOWm3XQ3eO6c41EMNS97pKOxq_qR4suTF5P_GqPF1n_-z2MSl7CKkeR5vCqgC7otQUV2KJSre5ki-uk3CUQAePsaK0ZuAf7vCR0u8y-mrBYKkKOLuFxxWvZCb0cR71uQrRL8HzHy8GmUH3igkIg9PIyaKcmgVmmmIlb2XSgkqJ7KNBk8sj1SeC0Wl5zofws7WGfj4gf8VEYcmimkffGQS3EvPoZhR3l7rp9bkh-eUZ5BxRSPwpimTKvidnjTNZTo40MY8JJzWSpzq50Ty0YF84ubxmdJpT8CF5Z45wwdMSshnB3yW79GQayg5F5l5-F58wRKKvTTebO_62gvlp6bDO0ghp5iNVp-J54-Mu4W_afwzJBo6FxFmbrdeL3kyFXtwexljJEIGdg-71TX_3dQfWk8nOw73udhp9tJeoGbvsLGmm0E6ilzK_X-BFc7rgE7nlBsr3_MdQuHT2Ix6TNo-4PsoLuvsLuHmnJ7vrgXM2VW9OHF2ThP6xfp7SCzrUb8Qd7Blh_k6X-Qh46M2LFDLLz3KtwgC7AdNpKEhvuXV9SrsessXBcM0T2YlgfXbk0DP3F80CT6iT7JQswfJuRpPX_hN4yvom8KrD2bac_EeB1CKcDR8yTwDiWK-cK8cLgmTW3BkvFZ3zLLWkJ4vnoUWiTPvCICedOHhf6jFdu10jiFs4wSLy6-s7T-xRXwvzwAmaM6946aem7qQpL2sqORjlQl5RHT2v5OnbW_jNI005cusw8ErSj7nBRy3BnDe-aQkbdA6rDM0mrU6KePYv8aZwaCwfmNRYZHoviDysh9x15CZei_ovstqwWvDvi51WH1C7vkF9947z_kU7MPv-G4HaMKa58G2of5X5JI0Ly_PZIbYzEyN9pC3DDbx_AUYppf3K2myKc_OPNp8HzKIhy07bzjjZls8S9g-mfIa0HXdQH_fdm3NeqcMVEIhtghjM1LMuwLr0B7O3FQlEAnc9nKL5NEs-O6tPJT6oYcJzTh4nJyRoQOyBwEoq6kvWrLTF0_FfmsHK8PxNX5D38JXy-T9exoipvUE_20g-v2XuqVlI9TBWSirivcyNk_RENkcbOhfcylnWklJizhsOTR5wveg7TdyMWJRG-aV5a6BUl-PEyfF7Y1G-iEUYX49h0Gteo3YTSK8Rz_A5FFnOnEaF945AKBf6Yaim0_xu73IQj9h25Zt_A1ZArtTALXHtx43d99kY0kvRp17dpQHJa7qzMlD5BZmrR3cHEp6dKWc6PNQca1-Qlf5lgHVBJ7zQt2u1vHNKCCcvk1cqIXPjKXf-tyB5ns3SjwadijoJTRtNQLIxg0vjy1lpBEY2fotCz517mbErfIFmkLM8NScb5cntAaNtjbMJR6VlXtdxZUZ9zUSA-8RXHPJlm5-Pk3F3ZegfdH-IUzG3dHRcjb2W8TKKAmlO6GxFd5JayGWeJPLWg7ZPZCu4Zy9WbCU4fdXe6N48eGs0D23FlpsajX-tct-hvcT_vObY-McJU9GP4xLdmMpZZNS_b_wlqUbiZwMgd3llQAAWesgHE4UM8sM8lOmeKa9fIgMn-DK1ukJ5yS5abpYq8-CQNMIy2ZvNaThWcSVnt6uXRFDqNwikAY9mgKALsbGZQcNL-EgCr1BAdJ_9Kvh_xg7S_FA22jixYG5T19noJNDYTe25wPYkDOU8Phnf8HwgMbvkveTeXzXCQ2touKjGY540iNMdPcaz0sQ3Ra27-UtKUhd1ftv5VRxC2IjUo1W2hh2eEAauGviXLGbbM87g2zOFFF4-J1I9mTxBHGFC72TNl_Qx87UDh1JoMxSqQxlL_YIvYE2346Kjmc1H78qfcGzAW2Xt_C48TPv2sRv51sOGSZWigzxRmIznCJtarTxjCGWlwLOwfg5DMuwyqTg-csJKU8Ygjl_MxMW9D9JwApPdVSmmNcTZAMi2feKJNAnknR-fcNAVt5rx-JCkW48hZfkalt9J_Z56BtcvY6SYe0Dd7rthCggYXxN1EBsHf1OIfOqQg.FnllHtipDFlU65BkhzXg6Q; mod_auth_openidc_session_chunks=2`
        }
    })
    .then(async (response) => {
      if (response.ok && response.body.length > 0) {
        console.log(`Appointment found in department ${code}`);
        alert(`Appointment available in ${code} department.`);
        chrome.tabs.create({
        url: "https://candidat.permisdeconduire.gouv.fr/api/v1/candidat/creneaux"
        });
      } else {
        console.warn(`No appoitment found for department code ${code}`);
      }
    })
    .catch((error) => {
      console.error(`Error fetching data for department code ${code}: ${error}`);
    });
  });
}
